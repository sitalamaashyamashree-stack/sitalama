<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Competition Registration</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<style>
body{
    font-family: Arial, sans-serif;
    background:#eef1f5;
    margin:0; padding:0;
}
.container{
    width:95%; max-width:600px;
    margin:40px auto; background:white;
    padding:30px; border-radius:16px;
    box-shadow:0 4px 20px rgba(0,0,0,0.1);
}
h2{text-align:center;font-size:26px;margin-bottom:20px;}
label{display:block;margin:10px 0 5px;font-weight:600;}
input, select{
    width:100%; padding:12px;
    border:1px solid #ccc; border-radius:8px;
    background:#f8f9fb; font-size:16px;
}

/* CATEGORY UI */
.category-list{
    border:1px solid #ddd;
    border-radius:10px;
    background:#fafafa;
    padding:10px 15px;
    margin-top:8px;
}
.cat-row{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:10px 0;
    border-bottom:1px solid #eee;
    font-size:15px;
}
.cat-row:last-child{border-bottom:none;}
.cat-row input[type="radio"]{
    width:22px; height:22px; cursor:pointer;
}

/* BUTTON */
button{
    width:100%; padding:15px;
    background:#0D6EFD; color:white;
    border:none; border-radius:10px;
    font-size:18px; font-weight:bold;
    cursor:pointer; margin-top:20px;
}
button:hover{background:#094eb3;}

/* TERMS */
.terms-row{
    display:flex; align-items:center;
    gap:10px; margin-top:15px; font-size:15px;
}
.terms-row input{width:20px;height:20px;}
.terms-row a{color:#0d6efd;font-weight:600;text-decoration:none;}
.terms-row a:hover{text-decoration:underline;}

.notice{
    font-size:14px; color:#444;
    margin-top:15px; line-height:1.5; text-align:center;
}

/* ERROR MESSAGE */
.error-msg{
    color:red;
    font-size:14px;
    margin-top:4px;
    font-weight:600;
}

/* RED BORDER ON INVALID */
input.invalid{border:2px solid red;}

/* MOBILE RESPONSIVE */
@media(max-width:480px){
    .container{padding:20px;}
    h2{font-size:22px;}
    input, select, button{font-size:16px;}
    .cat-row{font-size:14px;}
}
</style>
</head>

<body>

<div class="container">
<h2>Competition Registration</h2>

<label>Name *</label>
<input type="text" id="name">

<label>Guardian Name *</label>
<input type="text" id="guardian">

<label>Relation With Guardian *</label>
<select id="relation">
    <option value="">-- Select Relation --</option>
    <option value="Father">Father</option>
    <option value="Mother">Mother</option>
    <option value="Other">Other</option>
</select>

<label>Mobile No. (OTP Verify) *</label>
<input type="text" id="mobile">
<button onclick="sendOTP()">Send OTP</button>
<input type="text" id="otp" placeholder="Enter OTP">

<label>Email *</label>
<input type="email" id="email">

<label>Date of Birth *</label>
<input type="date" id="dob" oninput="liveDOBCheck()">
<div id="dobError" class="error-msg"></div>

<label>School / College / Institution (Optional)</label>
<input type="text" id="institution" placeholder="(Optional)">

<label>Category *</label>
<div class="category-list">
    <div class="cat-row"><span>Art & Craft (11-25 yrs) - ‚Çπ150</span><input type="radio" name="cat" value="Art & Craft"></div>
    <div class="cat-row"><span>Recitation (11-25 yrs) - ‚Çπ150</span><input type="radio" name="cat" value="Recitation"></div>
    <div class="cat-row"><span>Music (6-14 & 14-25) - ‚Çπ200</span><input type="radio" name="cat" value="Music"></div>
    <div class="cat-row"><span>Dance (6-14 & 14-25) - ‚Çπ200</span><input type="radio" name="cat" value="Dance"></div>
    <div class="cat-row"><span>Quiz (11-25 yrs) - ‚Çπ100 (No File Upload)</span><input type="radio" name="cat" value="Quiz"></div>
</div>

<label>Performance File (Not Needed For Quiz)</label>
<input type="file" id="performance" accept="video/*,audio/*,image/*">

<div class="terms-row">
    <input type="checkbox" id="terms">
    <label for="terms">I agree to the <a href="terms.html" target="_blank">Terms & Conditions & Digital Consent</a></label>
</div>

<button onclick="submitForm()">Submit & Pay</button>

<p class="notice">
‚ö† Age eligibility: <b>6 to 25 years</b> (calculated as of 01-Apr-2026). Fees are non-refundable. <br>
üìå <b>Registrations valid till January 1st.</b>
</p>
</div>


<script>
/* CONFIG */
const API_URL="https://api.ssmctrust.org";
const RAZORPAY_KEY="rzp_live_Rj6ceV2avDzdlC";

/* AGE CALC */
function calculateAge(dob){
    const d=new Date(dob);
    const check=new Date("2026-04-01");
    let age=check.getFullYear()-d.getFullYear();
    const m=check.getMonth()-d.getMonth();
    if(m<0||(m===0&&check.getDate()<d.getDate())) age--;
    return age;
}

/* LIVE DOB CHECK */
function liveDOBCheck(){
    let dob=document.getElementById("dob").value;
    let category=document.querySelector("input[name='cat']:checked")?.value;
    let age=calculateAge(dob);
    let msg=document.getElementById("dobError");
    let dobInput=document.getElementById("dob");

    msg.innerHTML=""; dobInput.classList.remove("invalid");
    if(!dob) return;

    if(age < 6){ msg.innerHTML="‚ùå Minimum age allowed is 6 years."; dobInput.classList.add("invalid"); return; }
    if(age > 25){ msg.innerHTML="‚ùå Maximum age allowed is 25 years."; dobInput.classList.add("invalid"); return; }

    if(category==="Quiz"||category==="Art & Craft"||category==="Recitation"){
        if(age<11||age>25) msg.innerHTML="‚ùå Age must be 11‚Äì25 years for this category.";
    }
    if(category==="Dance"||category==="Music"){
        if(age<6||age>25) msg.innerHTML="‚ùå Age must be 6‚Äì25 years for Dance/Music.";
    }
}

/* FEE */
function getFee(c){
    return c==="Quiz"?100:(c==="Dance"||c==="Music"?200:150);
}

/* FILE UPLOAD */
async function uploadFile(file,category){
    const fd=new FormData();
    fd.append("file",file);
    fd.append("category",category);
    return await fetch(API_URL+"?action=upload",{method:"POST",body:fd}).then(r=>r.json());
}

/* SUBMIT */
async function submitForm(){
    let dob=document.getElementById("dob").value;
    let age=calculateAge(dob);
    let category=document.querySelector("input[name='cat']:checked")?.value;
    let msg=document.getElementById("dobError");

    if(msg.innerHTML!=="") return; // Stop if DOB invalid

    const name=name.value.trim();
    const guardian=guardian.value.trim();
    const relation=relation.value.trim();
    const mobile=mobile.value.trim();
    const email=email.value.trim();
    const institution=document.getElementById("institution").value.trim() || "Not Provided";

    if(!name||!guardian||!relation||!mobile||!dob) return alert("‚ö† Required fields missing");
    if(!category) return alert("‚ö† Select a category");
    if(!terms.checked) return alert("‚ö† Accept terms to continue");

    const fee=getFee(category);
    let fileUrl="No Upload Needed";

    if(category!=="Quiz"){
        const file=document.getElementById("performance").files[0];
        if(!file) return alert("‚ö† Upload performance file required");
        const res=await uploadFile(file,category);
        if(res.status!=="success") return alert("‚ùå Upload failed");
        fileUrl=res.fileUrl;
    }

    const user={name,guardian,relation,mobile,email,dob,institution,category,fee,age,fileUrl};
    startPayment(user);
}

/* PAYMENT */
function startPayment(user){
    var options={
        key:RAZORPAY_KEY,
        amount:user.fee*100,
        currency:"INR",
        name:"Competition Registration",
        handler:function(res){
            user.payment_id=res.razorpay_payment_id;
            fetch(API_URL+"?action=register",{
                method:"POST",
                headers:{"Content-Type":"application/json"},
                body:JSON.stringify(user)
            }).then(r=>r.json()).then(data=>{
                alert("üéâ Registration Successful! Code: "+data.code);
                window.location.href=data.pdfUrl;
            });
        }
    };
    new Razorpay(options).open();
}

/* OTP PLACEHOLDER */
function sendOTP(){ alert("üîî Connect SMS API / Firebase for OTP"); }
</script>

</body>
</html>
