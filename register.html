<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Competition Registration</title>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">

<style>
body{
  font-family:'Poppins', sans-serif;
  background:#eef1f7;
  margin:0;
  display:flex;
  justify-content:center;
}
.container{
  background:white;
  width:95%;
  max-width:600px;
  padding:30px;
  margin:30px 0;
  border-radius:12px;
  box-shadow:0 8px 25px rgba(0,0,0,0.1);
}
h2{
  text-align:center;
  margin-bottom:20px;
  color:#0d47a1;
  font-weight:600;
  font-size:26px;
}
label{
  font-size:15px;
  font-weight:500;
  display:block;
  margin:10px 0 4px;
}
input, select{
  width:100%;
  padding:12px;
  border:1px solid #ccc;
  border-radius:6px;
  outline:none;
  font-size:15px;
}
input:focus, select:focus{
  border-color:#0d47a1;
  box-shadow:0 0 6px rgba(13,71,161,0.3);
}
button{
  width:100%;
  padding:15px;
  font-size:18px;
  border:none;
  color:white;
  background:#0d47a1;
  border-radius:8px;
  margin-top:20px;
  cursor:pointer;
  font-weight:600;
  transition:0.3s;
}
button:hover{
  background:#08306b;
}

#errorBox{
  display:none;
  padding:12px;
  background:#ffdddd;
  border-left:5px solid #e60000;
  margin-bottom:15px;
  border-radius:5px;
  color:#600;
  font-weight:500;
}
</style>
</head>

<body>
<div class="container">
<h2>Competition Registration</h2>

<div id="errorBox"></div>

<label>Name *</label>
<input id="name" type="text">

<label>Guardian Name *</label>
<input id="guardian" type="text">

<label>Relation *</label>
<select id="relation">
  <option value="">-- Select Relation --</option>
  <option value="Father">Father</option>
  <option value="Mother">Mother</option>
  <option value="Brother">Brother</option>
  <option value="Sister">Sister</option>
  <option value="Guardian">Guardian</option>
</select>

<label>Mobile *</label>
<input id="mobile" type="text" maxlength="10" placeholder="10-digit mobile number">

<label>Email *</label>
<input id="email" type="email">

<label>Date of Birth *</label>
<input id="dob" type="date">

<label>School / Institute (Optional)</label>
<input id="institution" type="text">

<label>Category *</label>
<select id="category">
  <option value="">-- Select Category --</option>
  <option value="Art">Art (11-25) - ‚Çπ150</option>
  <option value="Recitation">Recitation (11-25) - ‚Çπ150</option>
  <option value="Music">Music (6-25) - ‚Çπ200</option>
  <option value="Dance">Dance (6-25) - ‚Çπ200</option>
  <option value="Quiz">Quiz (11-25) - ‚Çπ100</option>
</select>

<br><br>
<label><input type="checkbox" id="terms"> I agree to Terms & Conditions</label>

<button onclick="submitForm()">Submit & Pay</button>
</div>


<!-- Razorpay SDK -->
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script>
// üåê Backend API (Do Not Change)
const API_URL = "https://register-worker.sitalamaashyamashree.workers.dev";

// üéØ Age Logic
function getAge(d){ return new Date("2026-01-01").getFullYear() - new Date(d).getFullYear(); }

// üí∞ Fee Logic
function fee(c){
  return c==="Quiz" ? 100 : (c==="Dance"||c==="Music"?200:150);
}

// üö´ Error Popup
function showError(msg){
  const box=document.getElementById("errorBox");
  box.style.display="block";
  box.innerText=msg;
}

// üöÄ Final Submit + Payment
async function submitForm(){

  let data = {
    name: name.value.trim(),
    guardian: guardian.value.trim(),
    relation: relation.value.trim(),
    mobile: mobile.value.trim(),
    email: email.value.trim(),
    dob: dob.value.trim(),
    institution: institution.value.trim()||"Not Provided",
    category: category.value.trim()
  };

  // ‚ùóValidation
  if(!data.name||!data.guardian||!data.relation||!data.mobile||!data.email||!data.dob||!data.category)
    return showError("‚ö† Please fill all required fields");

  if(!/^[0-9]{10}$/.test(data.mobile)) return showError("‚ö† Enter valid 10-digit mobile number");
  if(!/\S+@\S+\.\S+/.test(data.email)) return showError("‚ö† Enter valid email address");
  if(!terms.checked) return showError("‚ö† Please accept terms");

  // üßí Age Check
  let age = getAge(data.dob);
  if(age < 6 || age > 25) return showError("‚ùå Age must be 6 to 25 years");

  // üé´ Fix category + fee
  data.category = data.category.split(" ")[0];
  data.fee = Number(fee(data.category));

  // üí≥ Create Razorpay Order
  let order = await fetch(API_URL+"?action=create-order",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ amount:data.fee })
  }).then(r=>r.json());

  // üßæ Razorpay Checkout
  let pay = new Razorpay({
    key:"rzp_live_Rj6ceV2avDzdlC",
    order_id:order.id,
    amount:order.amount,
    currency:"INR",
    name:"Competition Registration",
    handler: async function(res){
      data.payment_id = res.razorpay_payment_id;

      let submit = await fetch(API_URL+"?action=register",{
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body:JSON.stringify(data)
      }).then(r=>r.json());

      if(submit.status === "success"){
        alert("üéâ Registration Successful!");
        window.location.href = "success.html?code="+submit.code+"&pdf="+submit.pdfUrl;
      } else {
        alert("‚ùå Something went wrong: "+submit.message);
      }
    }
  });

  pay.open();
}
</script>
</body>
</html>
