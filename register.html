<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Competition Registration</title>

<style>
/* -------- PAGE LAYOUT -------- */
body{
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg,#dfe9ff,#f6f9ff);
  margin:0; padding:0;
}
.container{
  max-width: 600px;
  margin: 35px auto;
  background: #ffffff;
  padding: 30px;
  border-radius: 14px;
  box-shadow: 0 10px 25px rgba(0,0,0,.08);
  animation: fade .6s ease-in-out;
}
@keyframes fade{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}

/* -------- FORM ELEMENTS -------- */
h2{
  text-align:center;
  margin-bottom:25px;
  color:#133b8c;
  font-size:28px;
  font-weight:700;
  letter-spacing:.5px;
}
label{
  font-weight:600;
  margin-top:12px;
  display:block;
  color:#333;
}
input, select{
  width:100%;
  padding:12px;
  margin-top:6px;
  border:1px solid #c7c7c7;
  border-radius:6px;
  font-size:16px;
  background:#fafafa;
}
input:focus, select:focus{
  border-color:#0057ff;
  outline:none;
  background:white;
  box-shadow:0 0 6px rgba(0,87,255,.3);
}

/* -------- BUTTON -------- */
button{
  width:100%;
  background:#0057ff;
  color:#fff;
  padding:15px;
  font-size:18px;
  font-weight:600;
  border:none;
  border-radius:8px;
  cursor:pointer;
  margin-top:20px;
  transition:.2s;
}
button:hover{
  background:#003bbd;
  transform:scale(1.02);
}

/* -------- TERMS CHECKBOX -------- */
.terms{
  margin-top:18px;
  font-size:14px;
  line-height:20px;
}

/* -------- CATEGORY BADGE STYLE -------- */
.cat-wrap{
  background:#f2f5ff;
  padding:10px 14px;
  border-left:4px solid #2b56ff;
  margin-top:8px; border-radius:6px;
}
.cat-wrap select{background:white;}

/* -------- FILE INPUT -------- */
#performance{
  background:white;
  border:1px dashed #aaa;
}

/* -------- RESPONSIVE -------- */
@media(max-width:480px){
  .container{padding:20px;margin:15px;}
  h2{font-size:22px;}
  input,select{font-size:15px;padding:10px;}
  button{font-size:16px;padding:12px;}
}
</style>
</head>

<body>
<div class="container">

<h2>Competition Registration</h2>

<label>Name *</label>
<input id="name">

<label>Guardian Name *</label>
<input id="guardian">

<label>Relation *</label>
<select id="relation">
<option value="">Select</option>
<option>Father</option><option>Mother</option><option>Brother</option><option>Sister</option><option>Other</option>
</select>

<label>Mobile *</label>
<input id="mobile" maxlength="10">

<label>Email *</label>
<input id="email">

<label>Date of Birth *</label>
<input type="date" id="dob">

<label>School / Institute (Optional)</label>
<input id="institution">

<div class="cat-wrap">
<label>Category *</label>
<select id="category">
<option value="">-- Select Category --</option>
<option value="Art">Art & Craft (11-25) - â‚¹150</option>
<option value="Recitation">Recitation (11-25) - â‚¹150</option>
<option value="Music">Music (6-25) - â‚¹200</option>
<option value="Dance">Dance (6-25) - â‚¹200</option>
<option value="Quiz">Quiz (11-25) - â‚¹100 (No Upload)</option>
</select>
</div>

<label>Performance File (Not For Quiz)</label>
<input type="file" id="performance">

<p class="terms"><input type="checkbox" id="terms"> I agree to Terms & Conditions</p>

<button onclick="submitForm()">Submit & Pay</button>

</div>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
/* ---------- CONFIG ---------- */
const API_URL = "https://register-worker.sitalamaashyamashree.workers.dev";
const RAZORPAY_KEY = "rzp_live_Rj6ceV2avDzdlC"; // ðŸ”¥ YOUR LIVE KEY

/* ---------- HELPERS ---------- */
function fee(c){return c==="Quiz"?100:(c==="Dance"||c==="Music"?200:150);}
function getAge(d){return new Date("2026-01-01").getFullYear()-new Date(d).getFullYear();}

/* ---------- UPLOAD FILE ---------- */
async function uploadFile(file){
 let form=new FormData();
 form.append("file",file);
 return await fetch(API_URL+"?action=upload",{method:"POST",body:form})
 .then(r=>r.json());
}

/* ---------- MAIN SUBMIT ---------- */
async function submitForm(){
 let data={
   name:name.value.trim(),
   guardian:guardian.value.trim(),
   relation:relation.value.trim(),
   mobile:mobile.value.trim(),
   email:email.value.trim(),
   dob:dob.value.trim(),
   institution:institution.value.trim()||"Not Provided",
   category:category.value
 };

 if(!data.name||!data.guardian||!data.relation||!data.mobile||!data.dob) return alert("âš  Fill all required details");
 if(!data.category) return alert("âš  Select a category");
 if(!terms.checked) return alert("âš  Accept terms first");
 
 let age=getAge(data.dob);
 if(age<6||age>25) return alert("âŒ Age must be between 6-25 years as of 01 Jan 2026");

 data.fee=fee(data.category);
 data.fileUrl="No Upload";

 if(data.category!=="Quiz"){
   let file=performance.files[0];
   if(!file) return alert("âš  Upload file required");
   let up=await uploadFile(file);
   if(up.status!=="success") return alert("âŒ Upload failed, try again");
   data.fileUrl=up.fileUrl;
 }

 let pay=new Razorpay({
   key:RAZORPAY_KEY, amount:data.fee*100, name:"Registration",
   handler:async(r)=>{
     data.payment_id=r.razorpay_payment_id;
     let s=await fetch(API_URL+"?action=register",{
       method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(data)
     }).then(r=>r.json());
     if(s.status==="success") return location.href="success.html?code="+s.code+"&pdf="+s.pdfUrl;
     alert(s.message);
   }
 });

 pay.open();
}
</script>

</body>
</html>
