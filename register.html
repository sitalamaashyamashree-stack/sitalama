<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Competition Registration</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<style>
body{font-family:Arial, sans-serif;background:#eef1f5;margin:0;padding:0;}
.container{width:95%;max-width:600px;margin:40px auto;background:#fff;
padding:30px;border-radius:16px;box-shadow:0 4px 20px rgba(0,0,0,0.1);}
h2{text-align:center;font-size:26px;margin-bottom:20px;}
label{display:block;margin:10px 0 5px;font-weight:600;}
input,select{width:100%;padding:12px;border:1px solid #ccc;border-radius:8px;
background:#f8f9fb;font-size:16px;}
.category-list{border:1px solid #ddd;border-radius:10px;background:#fafafa;
padding:10px 15px;margin-top:8px;}
.cat-row{display:flex;justify-content:space-between;align-items:center;
padding:10px 0;border-bottom:1px solid #eee;}
.cat-row:last-child{border-bottom:none;}
.cat-row input{width:22px;height:22px;cursor:pointer;}
button{width:100%;padding:15px;background:#0D6EFD;color:white;border:none;
border-radius:10px;font-size:18px;font-weight:bold;cursor:pointer;margin-top:20px;}
button:hover{background:#094eb3;}
.terms-row{display:flex;align-items:center;gap:10px;margin-top:15px;font-size:15px;}
.terms-row input{width:18px;height:18px;}
.terms-row a{color:#0d6efd;font-weight:600;text-decoration:none;}
.error-msg{color:red;font-size:14px;margin-top:4px;font-weight:600;}
input.invalid{border:2px solid red!important;}
.notice{text-align:center;font-size:14px;margin-top:15px;color:#444;}
@media(max-width:480px){input,select,button{font-size:16px;}}
</style>
</head>

<body>
<div class="container">

<h2>Competition Registration</h2>

<label>Name *</label>
<input id="name"/>

<label>Guardian Name *</label>
<input id="guardian"/>

<label>Relation *</label>
<select id="relation">
<option value="">-- Select --</option>
<option>Father</option><option>Mother</option><option>Other</option>
</select>

<label>Mobile Number *</label>
<input id="mobile" type="number"/>

<label>Email *</label>
<input id="email" type="email"/>

<label>Date of Birth *</label>
<input type="date" id="dob" oninput="liveDOBCheck()"/>
<div id="dobError" class="error-msg"></div>

<label>School / Institute (Optional)</label>
<input id="institution"/>

<label>Category *</label>
<div class="category-list">
<div class="cat-row"><span>Art & Craft (11-25 yrs) - ‚Çπ150</span><input type="radio" name="cat" value="Art & Craft"></div>
<div class="cat-row"><span>Recitation (11-25 yrs) - ‚Çπ150</span><input type="radio" name="cat" value="Recitation"></div>
<div class="cat-row"><span>Music (6-25 yrs) - ‚Çπ200</span><input type="radio" name="cat" value="Music"></div>
<div class="cat-row"><span>Dance (6-25 yrs) - ‚Çπ200</span><input type="radio" name="cat" value="Dance"></div>
<div class="cat-row"><span>Quiz (11-25 yrs) - ‚Çπ100 (No File Upload)</span><input type="radio" name="cat" value="Quiz"></div>
</div>

<label>Performance File (Not needed for Quiz)</label>
<input type="file" id="performance" accept="video/*,image/*,audio/*"/>

<div class="terms-row">
<input type="checkbox" id="terms"/>
<label>I agree to <a href="terms.html" target="_blank">Terms & Conditions & Digital Consent</a></label>
</div>

<button onclick="submitForm()">Submit & Pay</button>

<p class="notice">
‚ö† Age eligibility: **6 to 25 years (strict)** as on **01-Jan-2026**<br>
‚ùå Even **6y+1day or 25y+1day NOT allowed**<br>
üìÖ Allowed DOB: **01/01/2000 to 01/01/2020**
</p>

</div>


<script>
/* üî•UPDATED API URL*/
const API_URL = "https://register-worker.sitalamaashyamashree.workers.dev";
const RAZORPAY_KEY = "rzp_live_Rj6ceV2avDzdlC";

/* DOB STRICT RULE */
function strictDateCheck(d){
let i=new Date(d),min=new Date("2000-01-01"),max=new Date("2020-01-01");
if(i<min)return"‚ùå Age above 25 not allowed";
if(i>max)return"‚ùå Age below 6 not allowed";
if(i.getFullYear()===2000&&i>min)return"‚ùå 25y +1 day not allowed";
if(i.getFullYear()===2020&&i>max)return"‚ùå 6y +1 day not allowed";
return"";
}
function calculateAge(d){
const b=new Date(d),r=new Date("2026-01-01");
let a=r.getFullYear()-b.getFullYear(),m=r.getMonth()-b.getMonth(),da=r.getDate()-b.getDate();
if(m<0||(m===0&&da<0))a--;return a;
}

/* AGE-BASED CATEGORY VISIBILITY */
function liveDOBCheck(){
let d=dob.value,e=dobError,i=document.getElementById("dob");
e.innerHTML="";i.classList.remove("invalid");if(!d)return;
let c=strictDateCheck(d);if(c!==""){e.innerHTML=c;i.classList.add("invalid");hide();return;}
let age=calculateAge(d);age<11?child():showAll();
}
function hide(){document.querySelectorAll(".cat-row").forEach(r=>r.style.display="none");}
function child(){hide();document.querySelector('[value="Music"]').parentNode.style.display="flex";document.querySelector('[value="Dance"]').parentNode.style.display="flex";}
function showAll(){document.querySelectorAll(".cat-row").forEach(r=>r.style.display="flex");}

/* FEES */
function fee(c){return c==="Quiz"?100:(c==="Dance"||c==="Music"?200:150);}

/* UPLOAD */
async function uploadFile(file,cat){
let fd=new FormData();fd.append("file",file);
return fetch(API_URL+"?action=upload",{method:"POST",body:fd})
.then(r=>r.text()).then(t=>JSON.parse(t));
}

/* SUBMIT */
async function submitForm(){
if(dobError.innerHTML!=="")return alert("‚ùå Fix DOB first");
let data={
name:name.value.trim(),guardian:guardian.value.trim(),
relation:relation.value.trim(),mobile:mobile.value.trim(),
email:email.value.trim(),dob:dob.value,institution:institution.value||"Not Provided",
category:document.querySelector("input[name='cat']:checked")?.value
};
if(!data.name||!data.guardian||!data.relation||!data.mobile||!data.dob)return alert("‚ö† Fill required fields");
if(!data.category)return alert("‚ö† Select category");
if(!terms.checked)return alert("‚ö† Accept Terms First");

data.fee=fee(data.category);data.age=calculateAge(data.dob);
if(data.category!=="Quiz"){
const f=document.getElementById("performance").files[0];
if(!f)return alert("‚ö† File required");
let up=await uploadFile(f,data.category);if(up.status!=="success")return alert("‚ùå Upload Failed");
data.fileUrl=up.fileUrl;
}else data.fileUrl="No Upload";

/* PAYMENT */
let rz=new Razorpay({
key:RAZORPAY_KEY,amount:data.fee*100,name:"Competition Registration",
handler:function(r){
data.payment_id=r.razorpay_payment_id;
fetch(API_URL+"?action=register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(data)})
.then(r=>r.text()).then(t=>JSON.parse(t)).then(x=>{
if(x.status==="success"){alert("üéâ Registered!\nCode: "+x.code);window.location="success.html?code="+x.code+"&pdf="+x.pdfUrl;}
else alert("‚ùå "+x.message);
});
}});
rz.open();
}
</script>

</body>
</html>
