<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Competition Registration</title>

<style>
body{
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg,#dfe9ff,#f6f9ff);
  margin:0; padding:0;
}
.container{
  max-width: 600px;
  margin: 35px auto;
  background: #ffffff;
  padding: 30px;
  border-radius: 14px;
  box-shadow: 0 10px 25px rgba(0,0,0,.08);
  animation: fade .6s ease-in-out;
}
@keyframes fade{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
h2{
  text-align:center;
  margin-bottom:25px;
  color:#133b8c;
  font-size:28px;
  font-weight:700;
  letter-spacing:.5px;
}
label{font-weight:600;margin-top:12px;display:block;color:#333;}
input, select{
  width:100%;padding:12px;margin-top:6px;border:1px solid #c7c7c7;border-radius:6px;
  font-size:16px;background:#fafafa;
}
input:focus, select:focus{
  border-color:#0057ff;outline:none;background:white;
  box-shadow:0 0 6px rgba(0,87,255,.3);
}
button{
  width:100%;background:#0057ff;color:#fff;padding:15px;font-size:18px;font-weight:600;
  border:none;border-radius:8px;cursor:pointer;margin-top:20px;transition:.2s;
}
button:hover{background:#003bbd;transform:scale(1.02);}
.terms{margin-top:18px;font-size:14px;line-height:20px;}
.cat-wrap{background:#f2f5ff;padding:10px 14px;border-left:4px solid #2b56ff;margin-top:8px;border-radius:6px;}
#performance{background:white;border:1px dashed #aaa;}
#errorBox{
  margin-top:10px;
  padding:10px;
  color:#fff;
  background:#d40000;
  border-radius:6px;
  font-weight:600;
  display:none;
}
@media(max-width:480px){
  .container{padding:20px;margin:15px;}
  h2{font-size:22px;}
  input,select{font-size:15px;padding:10px;}
  button{font-size:16px;padding:12px;}
}
</style>
</head>

<body>
<div class="container">
<h2>Competition Registration</h2>

<label>Name *</label>
<input id="name">

<label>Guardian Name *</label>
<input id="guardian">

<label>Relation *</label>
<select id="relation">
<option value="">Select</option>
<option>Father</option><option>Mother</option><option>Brother</option><option>Sister</option><option>Other</option>
</select>

<label>Mobile *</label>
<input id="mobile" maxlength="10">

<label>Email *</label>
<input id="email">

<label>Date of Birth *</label>
<input type="date" id="dob">

<div id="errorBox"></div> <!-- üî• AGE ERROR SHOWS HERE -->

<label>School / Institute (Optional)</label>
<input id="institution">

<div class="cat-wrap">
<label>Category *</label>
<select id="category">
<option value="">-- Select Category --</option>
<option value="Art">Art & Craft (11-25) - ‚Çπ150</option>
<option value="Recitation">Recitation (11-25) - ‚Çπ150</option>
<option value="Music">Music (6-25) - ‚Çπ200</option>
<option value="Dance">Dance (6-25) - ‚Çπ200</option>
<option value="Quiz">Quiz (11-25) - ‚Çπ100 (No Upload)</option>
</select>
</div>

<label>Performance File (Not For Quiz)</label>
<input type="file" id="performance" accept="video/*">

<p class="terms"><input type="checkbox" id="terms"> I agree to Terms & Conditions</p>

<button onclick="submitForm()">Submit & Pay</button>
</div>









<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
const API_URL = "https://register-worker.sitalamaashyamashree.workers.dev";

const fields = {
 name: document.getElementById("name"),
 guardian: document.getElementById("guardian"),
 relation: document.getElementById("relation"),
 mobile: document.getElementById("mobile"),
 email: document.getElementById("email"),
 dob: document.getElementById("dob"),
 institution: document.getElementById("institution"),
 category: document.getElementById("category"),
 performance: document.getElementById("performance"),
 terms: document.getElementById("terms"),
 error: document.getElementById("errorBox")
};

// AGE & FEE
function getAge(d){ return new Date("2026-01-01").getFullYear() - new Date(d).getFullYear(); }
function fee(c){ c=c.trim(); return c==="Quiz"?100:(c==="Dance"||c==="Music"?200:150); }

// üì§ UPLOAD (MP4/JPG/PNG/MP3)
async function uploadFile(file){
 let form = new FormData();
 form.append("file", file);

 let res = await fetch(API_URL+"?action=upload",{
   method:"POST", body:form
 });

 let text = await res.text();
 try { return JSON.parse(text); } 
 catch { return { status:"error", message:"Upload failed", raw:text }; }
}

// üöÄ SUBMIT
async function submitForm(){
 let data = {
  name:fields.name.value.trim(),
  guardian:fields.guardian.value.trim(),
  relation:fields.relation.value.trim(),
  mobile:fields.mobile.value.trim(),
  email:fields.email.value.trim(),
  dob:fields.dob.value.trim(),
  institution:fields.institution.value.trim()||"Not Provided",
  category:fields.category.value.trim(),
 };

 // VALIDATE
 if(!data.name||!data.guardian||!data.mobile||!data.email||!data.dob||!data.category)
   return showError("‚ö† Fill all required fields");
 if(!/^[0-9]{10}$/.test(data.mobile)) return showError("‚ö† Invalid mobile");
 if(!/\S+@\S+\.\S+/.test(data.email)) return showError("‚ö† Invalid email");
 if(!fields.terms.checked) return showError("‚ö† Must accept terms");

 let age = getAge(data.dob);
 if(age<6||age>25) return showError("‚ùå Age must be 6-25 years");

 data.fee = Number(fee(data.category));

 // üìå IF NOT QUIZ ‚Üí UPLOAD
 data.fileUrl = "No Upload";
 if(data.category!=="Quiz"){
   let file = fields.performance.files[0];
   if(!file) return showError("‚ö† Upload required for this category");
   let up = await uploadFile(file);
   if(up.status!=="success") return showError("‚ùå Upload failed");
   data.fileUrl = up.fileUrl;
 }

 // üßæ CREATE PAYMENT ORDER
 let order = await fetch(API_URL+"?action=create-order",{
   method:"POST", headers:{ "Content-Type":"application/json" },
   body:JSON.stringify({ amount:data.fee })
 }).then(r=>r.json());

 // üí≥ PAYMENT
 let pay = new Razorpay({
  key:"rzp_live_Rj6ceV2avDzdlC",
  order_id:order.id,
  amount:order.amount,
  name:"Competition Registration",
  handler: async function (res){
    data.payment_id = res.razorpay_payment_id;

    let done = await fetch(API_URL+"?action=register",{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify(data)
    }).then(r=>r.json());

    if(done.status==="success"){
      window.location.href="success.html?code="+done.code+"&pdf="+done.pdfUrl;
    } else alert("‚ùå "+done.message);
  }
 });

 pay.open();
}

function showError(m){ fields.error.style.display="block"; fields.error.innerText=m; }
</script>


</body>
</html>
